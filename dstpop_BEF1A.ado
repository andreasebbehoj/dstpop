*! version 1.1.0 17aug2020
program define dstpop_BEF1A, rclass
version 15
syntax, tid(string) [omraade(string) civilstand(string) alder(string) koen(string)  ]  

*** Define variables and input
** Year
local api_tid = 			"&TID=" 		+ subinstr(trim("`tid'"), " ", "%2C", .)

** Marital status
if !mi("`civilstand'") {
    local api_civilstand =	"&CIVILSTAND=" 	+ subinstr("U G E F P L O", " ", "%2C", .)
}

** Age
if "`alder'"=="age" {
    local api_alder = 		"&ALDER=" + "%3E=0%3C=98," + /// 0-98
"sum(99-|[da%2099-%20%C3%A5r][en%2099-%20years]=99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125)" // 99-125 combined to 99-
}

** Sex
if !mi("`koen'") {
    local api_koen = 		"&KOEN=" 		+ subinstr("M K", " ", "%2C", .)
}

** Area
if "`omraade'"=="c_kom" {
    local api_omraade = 	"&OMR%C3%85DE="	+ subinstr("101 147 165 151 153 155 157 159 161 163 167 169 183 171 173 175 181 185 187 189 201 205 207 208 209 211 213 215 217 219 221 223 225 227 229 231 233 235 237 251 253 255 257 259 261 263 265 267 269 271 301 303 305 307 309 311 313 315 317 319 321 323 325 327 329 331 333 335 337 339 341 343 345 351 353 355 357 359 361 363 365 367 369 371 373 375 377 379 381 383 385 387 389 391 393 395 397 400 411 421 423 425 427 429 431 433 435 437 439 441 443 445 447 449 451 461 471 473 475 477 479 481 483 485 487 489 491 492 493 495 497 499 501 503 505 507 509 511 513 515 517 519 521 523 525 527 529 531 533 535 537 539 541 543 545 551 553 555 557 559 561 563 565 567 569 571 573 575 577 601 603 605 607 609 611 613 615 617 619 621 623 625 627 629 631 651 653 655 657 659 661 663 665 667 669 671 673 675 677 679 681 683 685 701 703 705 707 709 711 713 715 717 719 721 723 725 727 729 731 733 735 737 739 741 743 745 747 749 751 761 763 765 767 769 771 773 775 777 779 781 783 785 787 789 791 793 801 803 805 807 809 811 813 815 817 819 821 823 825 827 829 831 833 835 837 839 841 843 845 847 849 851 861", " ", "%2C", .) // 401 403 405 407 and 409 was combined into Bornholm Municipality 400 in 2003
}

if "`omraade'"=="c_reg" {
    local api_omraade = 	"&OMR%C3%85DE="	+ subinstr("101 147 165 151 153 155 157 159 161 163 167 169 183 171 173 175 181 185 187 189 201 205 207 208 209 211 213 215 217 219 221 223 225 227 229 231 233 235 237 251 253 255 257 259 261 263 265 267 269 271 301 303 305 307 309 311 313 315 317 319 321 323 325 327 329 331 333 335 337 339 341 343 345 351 353 355 357 359 361 363 365 367 369 371 373 375 377 379 381 383 385 387 389 391 393 395 397 400 411 421 423 425 427 429 431 433 435 437 439 441 443 445 447 449 451 461 471 473 475 477 479 481 483 485 487 489 491 492 493 495 497 499 501 503 505 507 509 511 513 515 517 519 521 523 525 527 529 531 533 535 537 539 541 543 545 551 553 555 557 559 561 563 565 567 569 571 573 575 577 601 603 605 607 609 611 613 615 617 619 621 623 625 627 629 631 651 653 655 657 659 661 663 665 667 669 671 673 675 677 679 681 683 685 701 703 705 707 709 711 713 715 717 719 721 723 725 727 729 731 733 735 737 739 741 743 745 747 749 751 761 763 765 767 769 771 773 775 777 779 781 783 785 787 789 791 793 801 803 805 807 809 811 813 815 817 819 821 823 825 827 829 831 833 835 837 839 841 843 845 847 849 851 861", " ", "%2C", .)
}
	
if "`omraade'"=="all" {
    local api_omraade = 	"&OMR%C3%85DE="	+ "*"
}

if inlist("`omraade'", "total", "all", "c_kom", "c_reg", "")==0 {
    local api_omraade = 	"&OMR%C3%85DE="	+ subinstr("`omraade'", " ", "%2C", .)
}


*** Output 
return local apiurl = "https://api.statbank.dk/v1/data/BEF1A" /// URL to registryÂ´s API
	/// Common settings
	+ "/CSV?" /// csv format
	+ "lang=en" ///
	+ "&valuePresentation=Code" /// Data in code format
	/// Inputs
	+ "`api_tid'" /// By year
	+ "`api_civilstand'" /// By marrital status
	+ "`api_alder'" /// By age
	+ "`api_koen'" /// By sex
	+ "`api_omraade'" // By area

end